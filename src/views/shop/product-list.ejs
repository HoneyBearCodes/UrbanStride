<%- include('../includes/head.ejs')  %>
<link rel="stylesheet" href="/css/error.css" />
<link rel="stylesheet" href="/css/queries.css" />
</head>

<body>
<%- include('../includes/navigation.ejs') %>

<!-- MAIN CONTENT -->
<main>
  <div class="container main">
    <% if (products.length > 0 ) { %>
    <!-- PRODUCTS GRID -->
    <div class="products grid grid--3-cols">
      <% for( let product of products ) { %>
      <!-- PRODUCT CARD -->
        <article class="product card">
          <% if (isAuthenticated) { %>
            <form action="/cart" method="post">
              <button class="add-to-cart" type="submit">
                <span class="material-symbols-outlined">add_shopping_cart</span>
              </button>
              <input type="hidden" name="productId" value="<%= product._id%>">
              <input type="hidden" name="_csrf" value="<%= CSRFToken %>">
            </form>
          <% } %>
        <header>
          <img
            class="product-img"
            src="<%= product.imageUrl %>"
            alt="product image"
          />
          <div class="product-details">
            <p class="product-title"><%= product.title %></p>
            <p class="product-price">$<%= product.price %></p>
          </div>
        </header>

        <footer class="product-actions">
          <form action="/products/<%= product._id %>" method="get">
            <button class="details" type="submit">
              View Details <span class="material-symbols-outlined">east</span>
            </button>
          </form>
        </footer>
        </article>
      <% } %>
    </div>

    <nav class="pagination margin-bottom-md">
      <ul class="pagination-links">
        <% if (currentPage !== 1 && previousPage !== 1) { %>
        <li><a href="?page=1" class="pagination-link">1</a></li>
        <% } %>
        <% if (hasPreviousPage) { %>
          <li><a href="?page=<%= previousPage %>" class="pagination-link"><%= previousPage %></a></li>
        <% } %>
        <li><a href="?page=<%= currentPage %>" class="pagination-link active"><%= currentPage %></a></li>
        <% if (hasNextPage) { %>
          <li><a href="?page=<%= nextPage %>" class="pagination-link"><%= nextPage %></a></li>
        <% } %>
        <% if (lastPage !== currentPage && nextPage !== lastPage) { %>
          <li><a href="?page=<%= lastPage %>" class="pagination-link"><%= lastPage %></a></li>
        <% } %>
      </ul>
    </nav>
    <% } else { %>
      <div class="error-card card card--linear margin-bottom-sm">
        <h1 class="error-code">Booo!!</h1>
        <p class="error-title">No Products Found!</p>
        <p class="error-subtitle margin-bottom-sm">
          But you can create new ones!
        </p>
        <p class="error-message">[üõçÔ∏è Products took a sabbatical üõí]</p>
      </div>
      <% } %>
<%- include('../includes/end.ejs') %>